# NeoChat TCP 版本使用指南

## 🎯 架构说明

```
浏览器客户端 (client.html)
    ↓ WebSocket (端口 8080)
桥接服务器 (bridge_server.py)
    ↓ TCP Socket
TCP 服务器 (server_tcp.py - 端口 9999)
    ↓ 支持内网穿透 TCP 隧道
```

## 🚀 快速启动

### 方法一：一键启动（推荐）
```bash
start_all_tcp.bat
```
这将自动启动：
- TCP 服务器 (端口 9999)
- WebSocket 桥接服务器 (端口 8080)
- 浏览器客户端

### 方法二：手动启动

**1. 启动 TCP 服务器**
```bash
python server_tcp.py
```

**2. 启动桥接服务器**（新终端）
```bash
python bridge_server.py
```

**3. 打开浏览器客户端**
- 打开 `client.html`
- 服务器地址选择 `桥接(8080)` 或输入 `localhost:8080`
- 输入用户名，点击连接

## 📱 客户端选项

### 1. 浏览器客户端（推荐）
- 打开 `client.html`
- 连接到桥接服务器 `localhost:8080`
- 美观的图形界面

### 2. Python 命令行客户端
```bash
python client_tcp.py
```
- 服务器地址：`localhost`
- 端口：`9999`
- 直接连接 TCP 服务器

## 🌐 内网穿透配置

### 创蓝隧道配置
- **协议类型**：TCP 隧道
- **本地 IP**：127.0.0.1
- **本地端口**：9999
- **远程端口**：自动分配（例如 57424）

### 使用穿透地址

**Python 客户端：**
```bash
python client_tcp.py
# 服务器地址: 111.161.121.11
# 端口: 57424
```

**浏览器客户端：**
暂不支持直接连接内网穿透，需要在服务器端部署桥接服务器

## 💡 功能特性

### 支持的命令
- `/help` - 显示帮助
- `/online` - 查看在线用户
- `/ping` - 测试连接
- `/stats` - 服务器统计信息

### 消息格式（JSON）
```json
// 系统消息
{
    "type": "system",
    "time": "2025-11-16 16:00:00",
    "message": "用户加入了聊天室"
}

// 用户消息
{
    "type": "message",
    "time": "2025-11-16 16:00:00",
    "username": "张三",
    "message": "Hello!"
}
```

## 🔧 端口说明

- **9999** - TCP 服务器端口（可内网穿透）
- **8080** - WebSocket 桥接服务器端口（本地使用）

## ⚠️ 注意事项

1. **浏览器限制**：浏览器不支持原始 TCP Socket，必须通过桥接服务器
2. **内网穿透**：TCP 隧道完美支持，无需 HTTP/WebSocket 支持
3. **兼容性**：客户端同时支持 JSON 格式和旧的文本格式

## 🆚 版本对比

| 特性 | WebSocket 版本 | TCP 版本 |
|------|---------------|---------|
| 浏览器直连 | ✅ | ❌（需桥接） |
| TCP 隧道穿透 | ❌ | ✅ |
| HTTP 隧道穿透 | ✅ | ❌ |
| 命令行客户端 | ❌ | ✅ |
| 消息格式 | 文本 | JSON |

## 📞 故障排查

### 浏览器无法连接
1. 确认 TCP 服务器正在运行（端口 9999）
2. 确认桥接服务器正在运行（端口 8080）
3. 浏览器连接地址：`localhost:8080`

### Python 客户端无法连接
1. 确认 TCP 服务器正在运行
2. 直接连接：`localhost:9999`
3. 检查防火墙设置

### 内网穿透无法连接
1. 确认隧道类型为 TCP（不是 HTTP）
2. 确认本地端口为 9999
3. 使用 Python 客户端测试
4. 浏览器客户端需要在远程部署桥接服务器
