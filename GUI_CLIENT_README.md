# NeoChat GUI 客户端使用说明

## 🖥️ 功能特点

这是一个基于 **Tkinter** 的图形界面 TCP 聊天客户端，具有以下特点：

### ✨ 主要功能
- ✅ **图形化登录界面** - 输入用户名和服务器地址
- ✅ **实时消息收发** - 支持发送和接收消息
- ✅ **美观的聊天界面** - 现代化 UI 设计
- ✅ **消息类型区分** - 系统消息和用户消息分别显示
- ✅ **自动滚动** - 新消息自动滚动到底部
- ✅ **快捷键支持** - Ctrl+Enter 发送消息
- ✅ **IP 防重复** - 服务器自动断开同一 IP 的旧连接

## 🚀 快速开始

### 1. 启动服务器
```bash
python server_tcp.py [端口]
```
默认端口: 9999

### 2. 启动客户端
```bash
python client_gui.py
```

### 3. 登录
在登录界面输入：
- **用户名**: 你的昵称（会自动生成默认值）
- **服务器地址**: 
  - 主机: `localhost` 或服务器 IP
  - 端口: `9999` 或自定义端口

### 4. 开始聊天
- 在输入框输入消息
- 点击"发送"按钮或按 `Ctrl+Enter` 发送

## 📋 界面说明

### 登录窗口
```
┌──────────────────────────────┐
│     🚀 NeoChat              │
├──────────────────────────────┤
│ 用户名:                      │
│ [User_XXX           ]        │
│                              │
│ 服务器地址:                  │
│ [localhost    ] : [9999]     │
│                              │
│      [    连接    ]          │
└──────────────────────────────┘
```

### 聊天窗口
```
┌────────────────────────────────────────┐
│  NeoChat 聊天室        👤 用户名       │
├────────────────────────────────────────┤
│                                        │
│  [消息显示区域]                        │
│  [12:34:56] 系统: 欢迎来到 NeoChat！   │
│  [12:35:01] 张三: 你好！               │
│  [12:35:05] 李四: 大家好               │
│                                        │
├────────────────────────────────────────┤
│  [输入消息...              ] [发送]    │
└────────────────────────────────────────┘
```

## 🎨 消息颜色说明

| 类型 | 颜色 | 说明 |
|------|------|------|
| 系统消息 | 灰色斜体 | 连接、断开等系统提示 |
| 其他用户 | 蓝色粗体 | 其他人发送的消息 |
| 自己 | 绿色粗体 | 自己发送的消息 |
| 时间戳 | 浅灰 | 消息发送时间 |

## ⌨️ 快捷键

| 快捷键 | 功能 |
|--------|------|
| `Enter` | 登录界面：连接服务器 |
| `Ctrl+Enter` | 聊天界面：发送消息 |

## 🔧 服务器 IP 防重复机制

服务器已实现 **基于 IP 地址的重复连接检测**：

1. **自动检测**: 当同一 IP 发起新连接时，服务器自动检测
2. **关闭旧连接**: 自动断开该 IP 的旧连接
3. **建立新连接**: 允许新连接正常建立
4. **日志记录**: 服务器控制台会显示相关日志

### 示例日志
```
[13:50:00.123] [WARNING] 检测到重复连接，关闭旧连接: User1 (192.168.1.100)
[13:50:00.125] [SUCCESS] ✓ User2 (192.168.1.100:54321) 加入聊天室 | 在线人数: 3
```

## 📦 依赖项

**纯 Python 标准库，无需安装额外依赖！**

使用的标准库模块：
- `tkinter` - GUI 界面（Python 自带）
- `socket` - TCP 网络通信
- `threading` - 多线程支持
- `json` - 消息格式解析
- `datetime` - 时间处理

## 🐛 常见问题

### 1. 无法连接到服务器
**问题**: 点击连接后提示"连接失败"

**解决方法**:
- 检查服务器是否已启动
- 确认服务器地址和端口正确
- 检查防火墙设置
- 尝试使用 `localhost` 或 `127.0.0.1` 连接本地服务器

### 2. 界面显示异常
**问题**: GUI 界面不显示或显示不正常

**解决方法**:
- 确保已安装 Python 的 tkinter 支持
- Windows: Python 安装时默认包含
- Linux: `sudo apt install python3-tk`
- macOS: 通常已包含

### 3. 发送消息失败
**问题**: 点击发送后没有反应

**解决方法**:
- 检查是否还连接到服务器
- 尝试重新连接
- 查看聊天窗口是否有系统错误提示

### 4. 同一电脑多个客户端
**问题**: 想在同一台电脑开多个客户端测试

**解决方法**:
- 直接运行多次 `python client_gui.py`
- 每个窗口使用不同的用户名
- 服务器会根据端口号区分连接（即使 IP 相同）

## 🎯 使用场景

### 局域网聊天
1. 在服务器电脑启动 `server_tcp.py`
2. 记录服务器 IP 地址（如 `192.168.1.100`）
3. 其他电脑运行 `client_gui.py` 并输入服务器 IP
4. 开始局域网聊天

### 内网穿透
1. 使用内网穿透工具（如 frp、ngrok）
2. 将服务器端口映射到公网
3. 客户端使用公网地址连接
4. 实现互联网聊天

### 测试开发
1. 启动服务器: `python server_tcp.py`
2. 启动多个客户端测试多用户聊天
3. 测试消息收发、用户进出等功能

## 🔐 安全提示

⚠️ **注意事项**:
- 此客户端为演示版本，未实现加密通信
- 不建议在公网直接使用
- 生产环境请添加 SSL/TLS 加密
- 建议配合防火墙和访问控制使用

## 📊 性能特点

- **轻量级**: 纯 Python 实现，资源占用少
- **响应快**: 使用异步 IO 和多线程
- **稳定性**: 自动重连和错误处理
- **跨平台**: Windows/Linux/macOS 都可运行

## 🛠️ 高级配置

### 修改默认服务器地址
编辑 `client_gui.py` 第 169-170 行：
```python
self.host_entry.insert(0, "你的服务器地址")
self.port_entry.insert(0, "你的端口")
```

### 修改窗口大小
编辑 `client_gui.py`：
- 登录窗口: 第 35 行 `self.window.geometry("400x300")`
- 聊天窗口: 第 168 行 `self.window.geometry("700x600")`

### 自定义颜色主题
编辑 `client_gui.py` 聊天窗口的标签配置：
```python
self.message_display.tag_config("system", foreground="#自定义颜色")
self.message_display.tag_config("username", foreground="#自定义颜色")
# ...
```

## 📝 更新日志

**v1.0** (2025-01-17)
- ✅ 初始版本发布
- ✅ 实现基础聊天功能
- ✅ 添加图形界面
- ✅ 支持 IP 防重复连接

## 🤝 技术支持

遇到问题？
1. 查看服务器控制台日志
2. 检查客户端是否有系统消息提示
3. 确认网络连接正常
4. 重启服务器和客户端

---

**祝你聊天愉快！** 🎉
