# NeoChat - 局域网聊天系统

一个高性能、简单易用的局域网聊天系统（C++ 实现），支持多客户端同时在线聊天。

## 功能特点

- ✅ C++ 高性能实现，稳定可靠
- ✅ 服务端/客户端架构
- ✅ 支持多客户端同时在线
- ✅ 实时消息转发
- ✅ 用户名自动保存和记忆
- ✅ 系统消息通知（用户加入/离开）
- ✅ 支持内网穿透，可通过公网访问
- ✅ 简洁的命令行界面
- ✅ 跨平台支持 (Windows/Linux/Mac)

## 系统要求

- C++11 或更高版本
- GCC 或 MinGW (Windows)
- 无需额外依赖库（仅使用标准库）

## 文件说明

```
NeoChat/
├── server.cpp         # 服务端程序
├── client.cpp         # 客户端程序
├── build.bat          # Windows 编译脚本
├── build.sh           # Linux/Mac 编译脚本
├── user_config.txt    # 用户配置文件（自动生成）
├── server.py          # Python 版本服务端（已废弃）
├── client.py          # Python 版本客户端（已废弃）
└── README.md          # 使用说明
```

## 使用方法

### 1. 编译程序

**Windows 用户：**
```bash
build.bat
```

**Linux/Mac 用户：**
```bash
chmod +x build.sh
./build.sh
```

编译成功后会生成：
- Windows: `server.exe` 和 `client.exe`
- Linux/Mac: `server` 和 `client`

### 2. 启动服务端

在服务器（或需要开启服务的电脑）上运行：

**Windows:**
```bash
server.exe
```

**Linux/Mac:**
```bash
./server
```

服务端默认监听端口：`9999`

如需修改端口，编辑 `server.cpp` 中的 `PORT` 变量并重新编译：

```cpp
const int PORT = 9999;  // 修改为你想要的端口
```

服务端启动后会显示：
```
==================================================
NeoChat 聊天服务器 (C++ 版本)
==================================================
[服务器] 启动成功！监听端口: 9999
[服务器] 等待客户端连接...
```

### 3. 启动客户端

在任意需要聊天的电脑上运行：

**Windows:**
```bash
client.exe
```

**Linux/Mac:**
```bash
./client
```

按照提示输入信息：

1. **服务器地址**：
   - 局域网：输入服务器的内网IP（如 `192.168.1.100`）
   - 公网：输入你的公网地址或域名（如 `frp-gap.com` 或 `123.45.67.89`）
   - **重要**：只输入地址，不要包含端口号

2. **服务器端口**：
   - 如果使用 frp 内网穿透，输入 frp 分配的端口（如 `25182`）
   - 局域网直连，输入 `9999`（或服务端设置的端口）
   - 直接回车使用默认端口 `9999`

3. **用户名**：
   - 首次使用：输入你的用户名
   - 再次使用：会自动加载上次保存的用户名，可选择使用或更换

**示例连接 frp 服务器：**
```
服务器地址: frp-gap.com
服务器端口: 25182
```

### 4. 开始聊天

连接成功后：
- 直接输入消息并按回车发送
- 输入 `quit` 退出程序
- 按 `Ctrl+C` 也可退出

## 内网穿透配置

如果需要让其他人通过公网连接到你的服务端，需要进行内网穿透。

### 重要说明

假设你的 frp 隧道地址是：`frp-gap.com:25182`

- **服务端**：运行在你的本地电脑，监听 `9999` 端口
- **frp 客户端**：将本地 `9999` 端口映射到 `frp-gap.com:25182`
- **其他用户连接**：使用 `frp-gap.com` 和端口 `25182`

### 方法一：使用 frp（推荐）

1. 下载 frp：https://github.com/fatedier/frp/releases
2. 配置 frpc.ini（frp 客户端配置）：

```ini
[common]
server_addr = your_frp_server.com
server_port = 7000

[neochat]
type = tcp
local_ip = 127.0.0.1
local_port = 9999        # NeoChat 服务端的本地端口
remote_port = 25182      # frp 服务器分配的远程端口（这个告诉其他用户）
```

3. 启动 NeoChat 服务端：
```bash
server.exe  # Windows
./server    # Linux/Mac
```

4. 启动 frp 客户端：
```bash
./frpc -c frpc.ini
```

5. 告诉其他用户连接信息：
   - 服务器地址：`frp-gap.com`（你的 frp 服务器域名）
   - 端口：`25182`（remote_port 的值）

**连接流程图：**
```
外网用户客户端
      ↓
frp-gap.com:25182 (frp 服务器对外端口)
      ↓
   frp 隧道
      ↓
127.0.0.1:9999 (你的 NeoChat 服务端)
```

### 方法二：使用花生壳、ngrok 等工具

按照相应工具的文档配置端口转发即可。

### 方法三：路由器端口映射

1. 登录路由器管理界面
2. 找到"端口映射"或"虚拟服务器"
3. 添加映射规则：外部端口 → 内网IP:9999
4. 其他用户使用你的公网IP和映射端口连接

## 使用示例

### 服务端输出示例
```
==================================================
NeoChat 聊天服务器 (C++ 版本)
==================================================
[服务器] 启动成功！监听端口: 9999
[服务器] 等待客户端连接...

按 Enter 键停止服务器...
[服务器] 新连接来自: 192.168.1.101:54321
[服务器] 小明 (192.168.1.101:54321) 加入聊天室
[消息] 小明: 大家好！
[服务器] 新连接来自: 192.168.1.102:54322
[服务器] 小红 (192.168.1.102:54322) 加入聊天室
[消息] 小红: 你好小明！
```

### 客户端输出示例
```
==================================================
NeoChat 聊天客户端 (C++ 版本)
==================================================

请输入服务器信息:
服务器地址 (例如: 192.168.1.100): frp-gap.com
服务器端口 (默认: 9999): 25182
[系统] 正在连接服务器...

检测到已保存的用户名: 小明
是否使用该用户名？(Y/n): y

[系统] 成功连接到服务器 frp-gap.com:25182
[系统] 你的用户名: 小明
--------------------------------------------------
开始聊天吧！输入消息并按回车发送，输入 'quit' 退出
--------------------------------------------------
[系统 2025-11-16 14:30:00] 欢迎来到 NeoChat！当前在线人数: 1
大家好！

[系统 2025-11-16 14:30:15] 小红 加入了聊天室
[2025-11-16 14:30:20] 小红: 你好小明！
```

## 注意事项

1. **防火墙设置**：确保服务端的端口（默认9999）在防火墙中开放
   - Windows: 控制面板 → Windows Defender 防火墙 → 高级设置 → 入站规则
   - Linux: `sudo ufw allow 9999`

2. **编译环境**：
   - Windows: 需要安装 MinGW 或使用 MSYS2
   - Linux/Mac: 系统自带 GCC

3. **安全性**：当前版本为局域网聊天工具，未加密通信，不建议用于传输敏感信息

4. **网络要求**：
   - 局域网使用：确保客户端和服务端在同一局域网内
   - 公网使用：需要配置内网穿透或公网IP

5. **用户名保存**：用户名保存在客户端本地的 `user_config.txt` 文件中

6. **IP地址格式**：客户端只支持 IPv4 地址格式，不支持域名解析（如需使用域名，请先 ping 获取 IP）

## 常见问题

**Q: 连接不上服务器怎么办？**
- 检查服务端是否正常运行
- 确认服务器地址和端口是否正确
- 检查防火墙设置
- ping 服务器地址测试网络连通性
- 如果使用 frp，确认 frp 客户端正在运行且状态正常

**Q: 编译时出现错误？**
- Windows: 确保已安装 MinGW 并添加到环境变量
- 检查 GCC 版本是否支持 C++11：`g++ --version`
- 尝试手动编译：
  ```bash
  # Windows
  g++ -std=c++11 server.cpp -o server.exe -lws2_32 -pthread
  g++ -std=c++11 client.cpp -o client.exe -lws2_32 -pthread
  
  # Linux/Mac
  g++ -std=c++11 server.cpp -o server -pthread
  g++ -std=c++11 client.cpp -o client -pthread
  ```

**Q: 如何查看服务器的内网IP？**
- Windows: 在命令行输入 `ipconfig`，查看 IPv4 地址
- Linux/Mac: 在终端输入 `ifconfig` 或 `ip addr`

**Q: 使用 frp 时如何连接？**
- 假设 frp 生成的地址是 `frp-gap.com:25182`
- 服务器地址输入：`frp-gap.com`
- 端口输入：`25182`
- **注意**：不要输入完整地址，要分开输入

**Q: 客户端不支持域名？**
- C++ 版本的客户端目前只支持 IP 地址
- 如果你的 frp 地址是域名，需要先解析成 IP：
  ```bash
  # Windows/Linux
  ping frp-gap.com
  ```
- 然后使用解析出的 IP 地址连接

**Q: 消息发送失败？**
- 检查网络连接是否稳定
- 尝试重新连接服务器

**Q: 如何更改用户名？**
- 方法1: 启动客户端时选择不使用保存的用户名
- 方法2: 删除 `user_config.txt` 文件后重新运行客户端

## 技术实现

- **语言**：C++11
- **协议**：TCP/IP
- **多线程**：每个客户端连接使用独立线程处理
- **编码**：UTF-8
- **跨平台**：支持 Windows、Linux、Mac

## C++ 版本优势

相比 Python 版本：
- ✅ 性能更高，响应更快
- ✅ 内存占用更小
- ✅ 无需安装运行时环境
- ✅ 编译后可独立运行
- ✅ 连接更稳定，不会卡死

## 开发者

项目地址：NeoChat

## 许可证

MIT License

---

享受聊天吧！有问题欢迎反馈。
